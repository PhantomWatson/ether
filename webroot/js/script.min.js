function toggleBGFade(e){e||(e=1e3),fading_interval_id?(clearInterval(fading_interval_id),fading_interval_id=0):fading_interval_id=setInterval(function(){adjustBackground()},e)}function adjustBackground(){if(!fading_mouseover_pause){var e=document.getElementById("body_tag"),t=new RGBColor(e.style.backgroundColor),n=Math.floor(3*Math.random()),o=0===Math.round(Math.random())?-1:1;0===n?target_color=t.r:1==n?target_color=t.g:2==n&&(target_color=t.b),1==o&&255<=target_color?o=-1:-1==o&&target_color<=0&&(o=1),0===n?t.r+=o:1==n?t.g+=o:2==n&&(t.b+=o),document.getElementById("toggleBGFade").innerHTML=t.toHex(),document.getElementById("toggleBGFade").style.color=t.toHex(),e.style.backgroundColor=t.toHex()}}var comment={add:function(e){var t=$("#newcomment"+e+"add");t.is(":visible")||($("#newcomment"+e+"button").slideUp(200),t.slideDown(200),t.find("textarea").focus())},cancel:function(e){var t=$("#newcomment"+e+"add");t.is(":visible")&&($("#newcomment"+e+"button").slideDown(200),t.slideUp(200))},insert:function(e){$("#newcomment"+e+"view").append($("#comment_just_added")),$("#comment_just_added").attr("id",""),$("#newcomment"+e+"add").find("textarea").html(""),this.cancel(e)}},thought={init:function(e){$("a.add_comment").click(function(e){e.preventDefault();var t=$(this).data("thoughtId");comment.add(t)}),$("a.cancel_comment").click(function(e){e.preventDefault();var t=$(this).data("thoughtId");comment.cancel(t)}),$("#add_thought").click(function(e){e.preventDefault(),thought.add()}),$("#cancel_thought").click(function(e){e.preventDefault(),thought.cancel()}),$("#dontwannathink").click(function(e){e.preventDefault(),thought.dontWannaThink()}),this.refreshFormatting(e.formattingKey)},add:function(){var e=$("#newthoughtadd");e.is(":visible")||(e.slideDown(200,function(){e.find("textarea").focus()}),$("#newthoughtbutton").hide())},cancel:function(){var e=$("#newthoughtadd");e.is(":visible")&&(e.slideUp(200),$("#newthoughtbutton").show())},dontWannaThink:function(){$("#wannathink_choices").slideUp(500,function(){$("#wannathink_rejection").slideDown(500)})},refreshFormatting:function(e){if(""!==e){var t=function(n,o){$("div."+n).each(function(){var e=$(this);if(e.data("formatting-key")!=o){var t=e.children(".body");$.ajax({url:"/"+n+"s/refreshFormatting/"+e.data(n+"-id"),dataType:"json",beforeSend:function(){""===t.html().trim()&&t.html('<img src="/img/loading_small.gif" alt="Loading..." />')},success:function(e){e.success&&e.update&&t.html(e.formattedThought)}})}})};t("thought",e),t("comment",e)}}},registration={color_avail_request:null,color_name_request:null,init:function(){new jscolor.color(document.getElementById("color_hex"),{hash:!1});$("#color_hex").change(function(){registration.validateColor()&&(registration.checkColorAvailability(),registration.getColorName())}),$("#UserRegisterForm").submit(function(e){return!!registration.validateColor()||(alert("Please select a valid color."),!1)}),registration.getColorName()},validateColor:function(){var e=$("#color_hex").val();if(new RegExp("^[0-9A-F]{6}$","i").test(e))return!0;var t="Bad news. "+e+" is not a valid hexadecimal color.";return this.showColorFeedback(t,"error"),!1},showColorFeedback:function(e,t){var n=$("#reg_color_input").find(".evaluation_message");e!==n.html()&&(n.is(":empty")?(n.hide(),n.html(e),n.removeClass("success error"),n.addClass(t),n.slideDown(500)):n.fadeOut(100,function(){n.html(e),n.removeClass("success error"),n.addClass(t),n.fadeIn(500)}))},checkColorAvailability:function(){var e=$("#color_hex").val();null!==this.color_avail_request&&this.color_avail_request.abort(),this.color_avail_request=$.ajax({url:"/users/checkColorAvailability/"+e,dataType:"json",beforeSend:function(){registration.showColorFeedback("Checking to see if that color is available...",null)},success:function(e){e.hasOwnProperty("available")&&"boolean"==typeof e.available?!0===e.available?registration.showColorFeedback("This color is available! :)","success"):!1===e.available&&registration.showColorFeedback("This color is already taken. :(","error"):registration.showColorFeedback("There was an error checking the availability of that color.",null)},error:function(){registration.showColorFeedback("There was an error checking the availability of that color.",null)},complete:function(){registration.color_avail_request=null}})},getColorName:function(){var e=$("#color_hex").val();null!==this.color_name_request&&this.color_name_request.abort();var t=$("#reg_color_input").find("label");this.color_name_request=$.ajax({url:"/colors/get-name/"+e,dataType:"json",beforeSend:function(){t.html('Color: <img src="/img/loading_small.gif" class="loading" alt="Loading..." />')},success:function(e){e.hasOwnProperty("name")?t.html('Color: "'+e.name+'"'):(t.html("Color"),console.log("Error retrieving color name"))},error:function(){t.html("Color"),console.log("Error retrieving color name")},complete:function(){registration.color_name_request=null}})}},flashMessage={fadeDuration:300,init:function(){var e=$("#flash_messages");e.children("li").fadeIn(this.fadeDuration),e.find("a").addClass("alert-link")},insert:function(e,t){var n=$('<li role="alert"></li>').addClass("col-sm-offset-2 col-sm-8 alert alert-dismissible alert-"+t).hide();n.append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'),n.append(e),n.find("a").addClass("alert-link"),$("#flash_messages").append(n),n.fadeIn(this.fadeDuration)}},thoughtwordIndex={init:function(){$(".shortcuts a").click(function(e){e.preventDefault(),$("html,body").animate({scrollTop:$(this.hash).offset().top},1e3)})}},userIndex={init:function(){$("#resize").click(function(e){e.preventDefault();var t=$(".users_index");t.hasClass("resized")?(t.removeClass("resized"),t.children(".colorbox").css({height:"",width:""})):userIndex.resizeColorboxes()})},resizeColorboxes:function(){$(".users_index").addClass("resized"),$(".users_index .colorbox").each(function(){var e=$(this).data("resize")/100*100;$(this).css({height:e+"px",width:e+"px"})})}},messages={currentRequest:null,init:function(){$("#conversations_index a").click(function(e){e.preventDefault();var t=$(this).data("color");messages.selectConversation(t)})},scrollToLastMsg:function(){var e=$("#conversation div.row:last-child");0!==e.length&&$(window).scrollTo(e,1e3,{interrupt:!0,offset:-100})},cancelCurrentRequest:function(){this.currentRequest&&this.currentRequest.abort(),$("#conversations_index .loading").removeClass("loading")},selectConversation:function(e,o){var a=$("#conversations_index"),i=a.find("a[data-color="+e+"]");this.cancelCurrentRequest(),i.addClass("loading"),this.currentRequest=$.ajax({url:"/messages/conversation/"+e,complete:function(){i.removeClass("loading")},success:function(e){a.find("a.selected").removeClass("selected"),i.addClass("selected");var t=$("#conversation");if(0<t.length?t.fadeOut(150,function(){messages.fadeInConversation(e)}):$("#selected_conversation_wrapper").fadeOut(150,function(){messages.fadeInConversation(e)}),o){var n=a.scrollTop()+i.position().top;a.animate({scrollTop:n},1e3)}}})},fadeInConversation:function(e){var t=$("#selected_conversation_wrapper"),n=$("#conversation");t.html(e),(n=$("#conversation")).fadeIn(150),t.is(":visible")?n.scrollTop(n.prop("scrollHeight")):t.fadeIn(150,function(){n.scrollTop(n.prop("scrollHeight"))}),t.find("form").submit(function(e){e.preventDefault(),messages.send()})},send:function(){var e=$("#selected_conversation_wrapper"),t=e.find("input[name=recipient]").val(),n={message:e.find("textarea").val(),recipient:t},o=e.find("input[type=submit]");$.ajax({type:"POST",url:"/messages/send",data:n,dataType:"json",beforeSend:function(){o.prop("disabled",!0),$('<img src="/img/loading_small.gif" class="loading" alt="Loading..." />').insertBefore(o)},success:function(e){e.error&&(flashMessage.insert(e.error,"error"),o.prop("disabled",!1),o.siblings("img.loading").remove()),e.success&&messages.selectConversation(t)},error:function(){flashMessage.insert("There was an error sending that message. Please try again.","error"),o.prop("disabled",!1),o.siblings("img.loading").remove()}})},setupPagination:function(){var e=$(".convo_pagination a"),t=$('<img src="/img/loading_small.gif" class="loading" alt="Loading..."/>');t.hide(),e.append(t),e.click(function(e){e.preventDefault();var n=$(this),t=n.attr("href").split("?");$.ajax({data:t[1],beforeSend:function(){var e=n.children(".loading");if(e.is(":visible"))return!1;e.show()},success:function(e){var t=n.parents(".row");t.after(e),t.remove(),messages.setupPagination()},error:function(){alert("There was an error loading more messages.")},complete:function(){n.children(".loading").hide()}})})}},profile={init:function(){var e=$("#profile_message_form"),a=e.find("textarea"),o=e.find("input[type='submit']"),i=e.find("div.submit");e.submit(function(e){e.preventDefault();var t=$(this).serializeArray(),n=$(this).attr("action");$.ajax({url:n,type:"POST",data:t,beforeSend:function(){o.prop("disabled",!0),a.prop("disabled",!0);var e=$('<img src="/img/loading_small.gif" class="loading" alt="Loading..." />');i.prepend(e),i.find(".result").fadeOut(200,function(){$(this).remove()})},success:function(e,t,n){i.find(".result").remove();var o=$(e);o.hide(),i.prepend(o),o.fadeIn(500),a.val("")},error:function(e,t,n){alert("There was an error sending that message. ("+t+")")},complete:function(){o.prop("disabled",!1),a.prop("disabled",!1),i.find(".loading").remove()}})})}},recentActivity={init:function(){var n=$("#recent");n.find(".nav a").click(function(e){e.preventDefault();var t=$(this);$.ajax({url:t.attr("href"),beforeSend:function(){n.fadeTo(200,.5)},success:function(e){n.fadeOut(100,function(){n.html(e),n.fadeTo(100,1)})},error:function(){n.fadeTo(200,1),alert("Whoops. There was an error. Please try again.")}})})}},scroll={init:function(){this.hashTargets("comment")&&this.toComment(),$(window).on("hashchange",function(e){e.preventDefault(),scroll.toComment()})},hashTargets:function(e){return"comment"==e&&location.hash.match(/^#c\d+$/)},toComment:function(){var e=location.hash.replace("#","").replace("c","");this.to("[data-comment-id="+e+"]")},to:function(e){var t=$(e);0!==t.length&&$(window).scrollTo(t,1e3,{interrupt:!0,offset:-100})}},search={init:function(){$("#header-search input").on("input",function(){var e=$(this),t=e.val(),n=t.replace(" ","");t!=n&&e.val(n),search.filterCloud(t)})},filterCloud:function(t){var e=$("#frontpage_cloud");0!==e.length&&(""!==t?e.find("> a.thoughtword").each(function(){var e=$(this);-1===$(e).html().trim().search(t)?e.hide():e.show()}):e.find("a").show())}},suggestedWords={init:function(){$("#suggested-words button").click(function(e){e.preventDefault();var t=$(this).html();$("#word").val(t),$("#suggested-words").slideUp(),$("#thought").focus()})}};